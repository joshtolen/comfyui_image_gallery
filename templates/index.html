<!DOCTYPE html>
<html>
<head>
    <title>ComfyUI Output Images</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">
</head>
<body class="dark-mode">
    <header>
        <div class="logo-container">
            <img class="logo" src="{{ url_for('static', filename='logo.png') }}" alt="ComfyUI Logo">
        </div>
    </header>
    <button id="delete-selected" class="delete-button">Delete Selected</button>
    <ul class="image-list">
        {% for img, thumbnail in current_thumbnails %}
            <li>
                <div class="thumbnail">
                    <!-- Individual checkbox -->
                    <input type="checkbox" class="file-checkbox" data-filename="{{ img }}">
                    <!-- Trash can icon -->
                    <div class="trash-icon" data-filename="{{ img }}">
                        &#128465; <!-- Unicode for trash can icon or use an icon font class -->
                    </div>
                    <!-- Thumbnail itself -->
                    <a data-fancybox="gallery" href="{{ url_for('static', filename='images/output/' + img) }}">
                        <img src="{{ url_for('static', filename='thumbnails/' + thumbnail) }}" alt="{{ thumbnail }}">
                    </a>
                </div>
            </li>
        {% endfor %}
    </ul>
    <div class="pagination">
        {% if page > 1 %}
            <a href="?page=1">&laquo; First</a>
            <a href="?page={{ page - 1 }}">Previous</a>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
            <a href="?page={{ p }}" {% if p == page %}class="current-page"{% endif %}>{{ p }}</a>
        {% endfor %}
        {% if page < total_pages %}
            <a href="?page={{ page + 1 }}">Next</a>
            <a href="?page={{ total_pages }}">Last &raquo;</a>
        {% endif %}
    </div>
    <footer class="footer">
    All images are copyrighted &#169; 2023
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
</body>
    <script>
        $(document).ready(function () {
            // Functionality for "Delete Selected" button
            $('#delete-selected').click(function () {
                const selectedFiles = [];
                $('.file-checkbox:checked').each(function () {
                    selectedFiles.push($(this).data('filename'));
                });

                if (selectedFiles.length === 0) {
                    alert('Please select at least one file to delete.');
                    return;
                }

                if (!confirm('Are you sure you want to delete the selected files?')) {
                    return;
                }

                $.ajax({
                    url: '/delete-files',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ files: selectedFiles }),
                    success: function (response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('An error occurred: ' + xhr.responseText);
                    }
                });
            });

            // Functionality for individual trash icons
            $('.trash-icon').click(function () {
                const filename = $(this).data('filename');
                if (!confirm('Are you sure you want to delete this file?')) {
                    return;
                }

                $.ajax({
                    url: '/delete-file',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ file: filename }),
                    success: function (response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('An error occurred: ' + xhr.responseText);
                    }
                });
            });
        });
    </script>
</html>
